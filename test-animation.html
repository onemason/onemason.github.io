<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>行星动画性能测试</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #181818;
            color: #dedede;
            font-family: monospace;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #5bac4a;
            margin-bottom: 30px;
        }

        .test-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .performance-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #5bac4a;
        }

        .info-card h3 {
            margin-top: 0;
            color: #cccccc;
        }

        .info-card p {
            margin: 5px 0;
            font-size: 14px;
        }

        .status-good {
            color: #0f0;
        }

        .status-warning {
            color: #ff0;
        }

        .status-bad {
            color: #f00;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        button {
            background: #5bac4a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: monospace;
            transition: background 0.3s;
        }

        button:hover {
            background: #4a9a3a;
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .animation-container {
            height: 400px;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
        }

        .fps-meter {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }

        .optimization-tips {
            background: rgba(91, 172, 74, 0.1);
            border: 1px solid #5bac4a;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
        }

        .optimization-tips h3 {
            margin-top: 0;
            color: #5bac4a;
        }

        .optimization-tips ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .optimization-tips li {
            margin-bottom: 5px;
        }

        code {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>行星动画性能测试</h1>

        <div class="test-section">
            <h2>优化说明</h2>
            <p>本次优化主要针对行星公转动画的掉帧问题，进行了以下改进：</p>

            <div class="optimization-tips">
                <h3>优化措施</h3>
                <ul>
                    <li><strong>移除z-index切换</strong>：原动画在49%-50%和99%-100%之间切换z-index，现改为纯transform动画</li>
                    <li><strong>GPU硬件加速</strong>：添加<code>transform: translateZ(0)</code>触发GPU加速</li>
                    <li><strong>性能提示</strong>：使用<code>will-change: transform</code>提示浏览器优化</li>
                    <li><strong>背面剔除</strong>：使用<code>backface-visibility: hidden</code>隐藏背面渲染</li>
                    <li><strong>降低perspective</strong>：从5000px降到3000px，减少3D计算复杂度</li>
                    <li><strong>调整默认速度</strong>：从2降到1，减少动画计算量</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h2>性能监控</h2>
            <div class="performance-info">
                <div class="info-card">
                    <h3>动画状态</h3>
                    <p id="animation-status">等待启动...</p>
                </div>
                <div class="info-card">
                    <h3>当前帧率</h3>
                    <p id="current-fps">-- FPS</p>
                </div>
                <div class="info-card">
                    <h3>性能评级</h3>
                    <p id="performance-grade">--</p>
                </div>
                <div class="info-card">
                    <h3>运行时间</h3>
                    <p id="running-time">0s</p>
                </div>
            </div>

            <div class="controls">
                <button id="start-btn">启动动画测试</button>
                <button id="stop-btn" disabled>停止测试</button>
                <button id="reset-btn">重置计数器</button>
                <button id="toggle-monitor">显示/隐藏监控面板</button>
                <button id="toggle-shadows">切换阴影效果</button>
                <button id="change-speed">调整动画速度</button>
            </div>

            <div class="animation-container" id="animation-area">
                <div class="fps-meter">
                    帧率: <span id="fps-display">--</span> FPS
                </div>
                <!-- 动画将通过JavaScript动态生成 -->
            </div>
        </div>

        <div class="test-section">
            <h2>测试说明</h2>
            <p>此测试页面用于验证行星动画优化后的性能表现。测试将模拟实际博客中的行星动画，并实时监控帧率。</p>
            <p><strong>性能标准：</strong></p>
            <ul>
                <li><span class="status-good">≥50 FPS</span>：优秀，动画非常流畅</li>
                <li><span class="status-warning">30-49 FPS</span>：可接受，轻微卡顿</li>
                <li><span class="status-bad">&lt;30 FPS</span>：需要进一步优化</li>
            </ul>
        </div>
    </div>

    <script>
        // 行星动画模拟
        class PlanetAnimation {
            constructor(containerId) {
                this.container = document.getElementById(containerId);
                this.planets = [];
                this.isRunning = false;
                this.frameCount = 0;
                this.lastTime = performance.now();
                this.fps = 60;
                this.startTime = 0;
                this.animationId = null;

                this.planetData = [
                    { name: '水星', radius: 25, orbit: 150, speed: 12, color: '#888' },
                    { name: '金星', radius: 48, orbit: 250, speed: 15, color: '#ffcc00' },
                    { name: '地球', radius: 50, orbit: 350, speed: 20, color: '#0066cc' },
                    { name: '火星', radius: 32, orbit: 450, speed: 30, color: '#cc3300' },
                    { name: '木星', radius: 110, orbit: 550, speed: 50, color: '#ff9966' }
                ];

                this.init();
            }

            init() {
                // 创建太阳
                const sun = document.createElement('div');
                sun.className = 'sun';
                sun.style.cssText = `
                    position: absolute;
                    width: 150px;
                    height: 150px;
                    background: radial-gradient(circle, #ffcc00, #ff6600);
                    border-radius: 50%;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    box-shadow: 0 0 60px #ff6600;
                `;
                this.container.appendChild(sun);

                // 创建行星
                this.planetData.forEach((planet, index) => {
                    const planetEl = document.createElement('div');
                    planetEl.className = `planet planet-${index}`;
                    planetEl.style.cssText = `
                        position: absolute;
                        width: ${planet.radius}px;
                        height: ${planet.radius}px;
                        background: ${planet.color};
                        border-radius: 50%;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        transform-origin: ${planet.orbit}px 0;
                        will-change: transform;
                        backface-visibility: hidden;
                    `;

                    this.container.appendChild(planetEl);
                    this.planets.push({
                        element: planetEl,
                        angle: 0,
                        speed: (Math.PI * 2) / (planet.speed * 1000), // 弧度/毫秒
                        originalSpeed: planet.speed,
                        orbit: planet.orbit
                    });
                });
            }

            start() {
                if (this.isRunning) return;

                this.isRunning = true;
                this.startTime = performance.now();
                this.lastTime = this.startTime;
                this.frameCount = 0;
                this.animate();

                // 更新状态显示
                document.getElementById('animation-status').textContent = '运行中';
                document.getElementById('animation-status').className = 'status-good';
            }

            stop() {
                this.isRunning = false;
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                    this.animationId = null;
                }

                // 更新状态显示
                document.getElementById('animation-status').textContent = '已停止';
                document.getElementById('animation-status').className = '';
            }

            animate() {
                if (!this.isRunning) return;

                const currentTime = performance.now();
                const deltaTime = currentTime - this.lastTime;

                // 更新行星位置
                this.planets.forEach(planet => {
                    planet.angle += planet.speed * deltaTime;
                    if (planet.angle > Math.PI * 2) {
                        planet.angle -= Math.PI * 2;
                    }

                    const x = Math.cos(planet.angle) * planet.orbit;
                    const y = Math.sin(planet.angle) * planet.orbit;

                    planet.element.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
                });

                // 计算FPS
                this.frameCount++;
                if (currentTime - this.lastTime >= 1000) {
                    this.fps = this.frameCount;
                    this.frameCount = 0;
                    this.lastTime = currentTime;

                    this.updateDisplay();
                }

                // 更新运行时间
                const runningTime = ((currentTime - this.startTime) / 1000).toFixed(1);
                document.getElementById('running-time').textContent = `${runningTime}s`;

                this.animationId = requestAnimationFrame(() => this.animate());
            }

            updateDisplay() {
                // 更新FPS显示
                document.getElementById('current-fps').textContent = `${this.fps} FPS`;
                document.getElementById('fps-display').textContent = this.fps;

                // 更新性能评级
                const gradeElement = document.getElementById('performance-grade');
                if (this.fps >= 50) {
                    gradeElement.textContent = '优秀';
                    gradeElement.className = 'status-good';
                    document.getElementById('current-fps').className = 'status-good';
                } else if (this.fps >= 30) {
                    gradeElement.textContent = '可接受';
                    gradeElement.className = 'status-warning';
                    document.getElementById('current-fps').className = 'status-warning';
                } else {
                    gradeElement.textContent = '需要优化';
                    gradeElement.className = 'status-bad';
                    document.getElementById('current-fps').className = 'status-bad';
                }
            }

            reset() {
                this.planets.forEach(planet => {
                    planet.angle = 0;
                    planet.element.style.transform = 'translate(-50%, -50%)';
                });

                this.frameCount = 0;
                this.lastTime = performance.now();
                this.fps = 60;
                this.updateDisplay();

                document.getElementById('running-time').textContent = '0s';
            }
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            const animation = new PlanetAnimation('animation-area');

            // 按钮事件
            document.getElementById('start-btn').addEventListener('click', () => {
                animation.start();
                document.getElementById('start-btn').disabled = true;
                document.getElementById('stop-btn').disabled = false;
            });

            document.getElementById('stop-btn').addEventListener('click', () => {
                animation.stop();
                document.getElementById('start-btn').disabled = false;
                document.getElementById('stop-btn').disabled = true;
            });

            document.getElementById('reset-btn').addEventListener('click', () => {
                animation.reset();
            });

            document.getElementById('toggle-monitor').addEventListener('click', () => {
                const monitor = document.querySelector('.fps-meter');
                if (monitor.style.display === 'none') {
                    monitor.style.display = 'block';
                } else {
                    monitor.style.display = 'none';
                }
            });

            // 阴影控制
            let shadowsEnabled = true;
            document.getElementById('toggle-shadows').addEventListener('click', () => {
                shadowsEnabled = !shadowsEnabled;
                const planets = document.querySelectorAll('.planet');
                planets.forEach(planet => {
                    if (shadowsEnabled) {
                        planet.style.boxShadow = 'inset 0 0 20px rgba(0, 0, 0, 0.5)';
                    } else {
                        planet.style.boxShadow = 'none';
                    }
                });
                document.getElementById('toggle-shadows').textContent =
                    shadowsEnabled ? '禁用阴影' : '启用阴影';
            });

            // 速度控制
            let speedMultiplier = 1;
            document.getElementById('change-speed').addEventListener('click', () => {
                speedMultiplier = speedMultiplier === 1 ? 0.5 : speedMultiplier === 0.5 ? 2 : 1;
                animation.planets.forEach(planet => {
                    // 使用保存的原始速度重新计算
                    planet.speed = (Math.PI * 2) / (planet.originalSpeed * 1000 * speedMultiplier);
                });
                document.getElementById('change-speed').textContent =
                    `速度: ${speedMultiplier}x`;
            });

            // 初始显示
            animation.updateDisplay();
        });
    </script>
</body>
</html>