<!DOCTYPE html>
<html>
<head>
    <script src="/prism/prism.js" async></script>
    <link rel="stylesheet" href="/prism/prism.css">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="文&#x2F;年容  CAP定理（CAP theorem）  C：一致性，集群内所有数据副本保持一致 A：可用性，集群内部分数据副本故障依然能保证提供服务 P：容错性，即使导致分区，也要保证提供服务   BASE（Basically Available Soft State Eventually Consistency）  对AP的补充，集群中数据副本达到最终一致性   2PC  Phase  V">
<meta property="og:type" content="article">
<meta property="og:title" content="分布式事务">
<meta property="og:url" content="http://yoursite.com/2022/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/index.html">
<meta property="og:site_name" content="泥瓦匠">
<meta property="og:description" content="文&#x2F;年容  CAP定理（CAP theorem）  C：一致性，集群内所有数据副本保持一致 A：可用性，集群内部分数据副本故障依然能保证提供服务 P：容错性，即使导致分区，也要保证提供服务   BASE（Basically Available Soft State Eventually Consistency）  对AP的补充，集群中数据副本达到最终一致性   2PC  Phase  V">
<meta property="og:locale">
<meta property="article:published_time" content="2022-10-13T16:00:00.000Z">
<meta property="article:modified_time" content="2022-10-17T10:49:05.342Z">
<meta property="article:author" content="泥瓦匠">
<meta name="twitter:card" content="summary">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="192x192" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>分布式事务</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">

    
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

    
<link rel="stylesheet" href="/css/style.css">

    <!-- rss -->
    
    
    <!-- jquery -->
    
<script src="/lib/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 6.2.0"></head>

<body>
    <div class="banner">
<div id="blogtitel" class="blogtitel">泥瓦匠</div>
<ul id="wrapper" class="wrapper">
  <div class="sun">
    <div class="star"></div>
  </div>
  <div class="mercury">
    <div class="planet">
      <div class="shadow"></div>
    </div>
  </div>
  <div class="venus">
    <div class="planet">
      <div class="shadow"></div>
    </div>
  </div>
  <div class="earth">
    <div class="planet"><div class="shadow"></div></div>
  </div>
  <div class="mars">
    <div class="planet"><div class="shadow"></div></div>
  </div>
  <div class="jupiter">
    <div class="planet"><div class="shadow"></div></div>
  </div>
</ul>
</div>

    <div class="background">
      
        <div id="header-post">
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2022/%E7%BC%98/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li>
        
        
        <li><a class="icon" href="/2022/%E5%A4%B1%E6%8E%A7/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
    </span>
    <br/>
  </span>
</div>

      
      <div class="content index width mx-auto px2 my4">
          
          <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        分布式事务
    </h1>



  </header>
  

  <div class="content" itemprop="articleBody">
    <p>文&#x2F;年容</p>
<ul>
<li><p>CAP定理（CAP theorem）</p>
<ul>
<li>C：一致性，集群内所有数据副本保持一致</li>
<li>A：可用性，集群内部分数据副本故障依然能保证提供服务</li>
<li>P：容错性，即使导致分区，也要保证提供服务</li>
</ul>
</li>
<li><p>BASE（Basically Available Soft State Eventually Consistency）</p>
<ul>
<li>对AP的补充，集群中数据副本达到最终一致性</li>
</ul>
</li>
<li><p>2PC</p>
<ul>
<li><p>Phase</p>
<ul>
<li><p>Voting Phase</p>
<ul>
<li>参与者锁定该事务所有的资源并且写undo log 和 redo log</li>
</ul>
</li>
<li><p>Commit Phase</p>
<ul>
<li>参与者提交事务</li>
</ul>
</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li><p>阻塞</p>
<ul>
<li>参与者需要等待协调者的指令</li>
<li>协调者需要等待所有参与者的响应</li>
</ul>
</li>
<li><p>数据不一致</p>
<ul>
<li>部分参与者提交部分参与者未提交导致数据不一致</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>3PC</p>
<ul>
<li><p>Phase</p>
<ul>
<li><p>canCommit</p>
<ul>
<li>询问</li>
</ul>
</li>
<li><p>preCommit</p>
<ul>
<li>参与者锁定该事务所有的资源并且写undo log 和 redo log</li>
</ul>
</li>
<li><p>doCommit</p>
<ul>
<li>参与者提交事务</li>
</ul>
</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li>引入canCommit阶段可以排除一些不具备处理事务能力的参与者，降低参与者状态未知的概率</li>
<li>preCommit阶段参与者等待超时会默认执行commit操作，降低了同步阻塞</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>数据不一致问题</li>
</ul>
</li>
</ul>
</li>
<li><p>TCC（服务化的资源管理器 2PC的一种实现）</p>
<ul>
<li><p>Try 预留资源</p>
</li>
<li><p>Comfirm 提交</p>
</li>
<li><p>Cancel 回滚</p>
</li>
<li><p>资源悬挂问题</p>
<ul>
<li>由于网络问题使Cancel的执行比Try先执行，Try阶段申请的资源一直无法释放</li>
</ul>
</li>
<li><p>幂等问题解决</p>
</li>
</ul>
</li>
<li><p>SAGA</p>
<ul>
<li>把一个大事务T分成若干个小的本地事务(t1,t2…tn)，若ti失败，则补偿(类似于回滚)t1到ti的所有事务</li>
<li>如果无法补偿，则不断重试ti尽最大努力交付</li>
</ul>
</li>
</ul>

  </div>
</article>




      </div>
      
       <div id="footer-post-container">
  <div id="footer-post">
  </div>
</div>

      
      <footer id="footer">
    <!-- <div class="footer">
      &copy; 2022 泥瓦匠 Powered By Hexo
    </div> -->
</footer>
  
      
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>


<script src="/js/main.js"></script>

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-130235178-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->


    </div>
</body>
</html>
